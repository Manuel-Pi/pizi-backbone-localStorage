<html>
<head>
  <meta charset="utf-8">
  <title>pizi-backbone-localStorage global test</title>
  <link rel="stylesheet" href="//code.jquery.com/qunit/qunit-1.18.0.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="//code.jquery.com/qunit/qunit-1.18.0.js"></script>
  <script src="underscore.js"></script>
  <script src="jquery.js"></script>
  <script src="backbone.js"></script>
  <script src="pizi-localStorage.js"></script>
  <script src="pizi-backbone-localStorage.js"></script>
  <script>
	  	var global = this;
		QUnit.test( "Root module declaration", function( assert ) {
			assert.ok( global.piziBackboneLocalStorage, "Module initialized!" );
			assert.ok( global.piziBackboneLocalStorage.apply, "Apply function available!" );
			assert.ok( global.piziBackboneLocalStorage.disable, "Disable function available!" );
		});
	  	/*
	  	QUnit.test( "AMD module declaration", function( assert ) {
		 	var requireLoadingDone = assert.async();
			$.getScript("//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.20/require.min.js", function(){
				assert.ok(define, "RequireJs is loaded!");
				var moduleLoadingDone = assert.async();
				require(['pizi-backbone-localStorage'], function(piziBackboneLocalStorage){
					assert.ok(piziBackboneLocalStorage, "Module is defined!");
					assert.ok(piziBackboneLocalStorage.apply, "Apply function available!");
					assert.ok(piziBackboneLocalStorage.disable, "Disable function available!");
					moduleLoadingDone();
				});
				requireLoadingDone();
			});
	  	});
		*/
		QUnit.test( "Override Backbone.sync", function( assert ) {
			global.piziBackboneLocalStorage.apply();
			assert.ok(global.Backbone.defaultSync && global.Backbone.defaultSync !== global.Backbone.sync, "Backbone synch overrrided!");
			saveGetTest();
		});
		
		function saveGetTest(){
			QUnit.test( "Save and get Backbone model", function( assert ) {
				var Model = global.Backbone.Model.extend({
					className: "test"
				});
				var model = new Model({
					foo: "foo",
					bar: "bar"
				});
				var moduleSaveDone = assert.async();
				model.save({
					success: function(model){
						assert.ok(true, "model saved!");
						moduleSaveDone();
					}
				});
			});
		}
	  
  </script>
</body>
</html>